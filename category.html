<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Category - Hemaavathi Fashions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <link 
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" 
    rel="stylesheet" 
  />
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
  />
</head>
<body>
  <header>
    <img src="assets/logo.png" alt="Hemaavathi Fashions Logo" class="logo" width="160" height="85" />
    <nav class="navbar" aria-label="Primary navigation">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="policy.html">Policies</a>
    </nav>
  </header>

  <main class="main-content">
    <section class="category-header" aria-label="Category header">
      <h1 id="category-title">Loading...</h1>
      <p id="category-description"></p>
    </section>

    <section id="product-list" class="product-grid" aria-live="polite" aria-label="Product list">
      <!-- Products will be dynamically inserted here -->
    </section>
  </main>

  <footer>
    <nav class="footer-links" aria-label="Footer navigation">
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="policy.html">Policies</a>
      <a href="https://wa.me/919492324225" target="_blank" rel="noopener noreferrer">WhatsApp</a>
    </nav>

    <nav class="footer-social" aria-label="Social media links">
      <a href="https://instagram.com/hemaavathi__fashions" target="_blank" rel="noopener noreferrer" aria-label="Instagram"
        ><i class="fab fa-instagram"></i
      ></a>
      <a href="https://facebook.com/profile.php?id=61574970737394" target="_blank" rel="noopener noreferrer" aria-label="Facebook"
        ><i class="fab fa-facebook-f"></i
      ></a>
      <a href="https://youtube.com/@Hemaavathifashions" target="_blank" rel="noopener noreferrer" aria-label="YouTube"
        ><i class="fab fa-youtube"></i
      ></a>
    </nav>
    <div style="margin-top: 18px; font-size: 0.9em;">&copy; 2025 Hemaavathi Fashions</div>
  </footer>

  <script>
    // Helper: get category name from URL querystring ?Women or ?category=Women
    function getCategoryFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('category') || location.search.slice(1) || '';
    }

    async function fetchJson(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Failed to load ${url}`);
        return await res.json();
      } catch (err) {
        console.error(err);
        return null;
      }
    }

    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" loading="lazy" />
        <div class="prod-info">
          <span class="prod-name">${product.name}</span><br />
          <span class="prod-price">â‚¹${product.price}</span>
          ${product.sizes ? `<br/><small>Sizes: ${product.sizes.join(', ')}</small>` : ''}
        </div>`;
      return card;
    }

    async function renderCategory() {
      const category = getCategoryFromUrl();

      const titleEl = document.getElementById('category-title');
      const descEl = document.getElementById('category-description');
      const productListEl = document.getElementById('product-list');

      if (!category) {
        titleEl.textContent = 'No Category Selected';
        descEl.textContent = 'Please select a category from the home page.';
        return;
      }

      titleEl.textContent = 'Loading...';
      descEl.textContent = '';
      productListEl.innerHTML = '';

      // Load category headers and products JSON
      const [headers, products] = await Promise.all([
        fetchJson('categoryHeaders.json'),
        fetchJson('products.json'),
      ]);

      titleEl.textContent = headers?.[category]?.title || category;
      descEl.textContent = headers?.[category]?.text || '';

      if (!products || products.length === 0) {
        productListEl.innerHTML = '<p>Sorry, products could not be loaded at this time.</p>';
        return;
      }

      // Filter products starting with category path (case sensitive)
      // E.g. category = "Women", product.category = "Women/Sarees/Pattu"
      const filteredProducts = products.filter(p => p.category.startsWith(category));

      if (filteredProducts.length === 0) {
        productListEl.innerHTML = '<p>No products found in this category.</p>';
        return;
      }

      // Render each product card
      filteredProducts.forEach(product => {
        const card = createProductCard(product);
        productListEl.appendChild(card);
      });
    }

    window.addEventListener('DOMContentLoaded', renderCategory);
  </script>
</body>
</html>
